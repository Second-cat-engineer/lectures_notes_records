## Урок 6. Практика: Как написать программу.

Что важно для заказчика
Что важно для программиста
Плюсы и минусы ActiveRecord и CRUD
Куда поместить бизнес-логику... и прочие вещи.

Примером будет проект "Автоматизация приема сотрудников на работу, установка
им зарплаты и так далее" (автоматизация отдела кадров).

Сначала попробуем разработать проект по принципу database-first.

[Схема таблиц проекта](db_schema.md). Для каждого типа приказа свой таблица,
а нумерация и дата приказа хранится в таблице `order`, чтобы была сквозная
нумерация для всех приказов.

Придем к пониманию, что в этом случае возникнут проблемы, и попробуем уйти
от принципа database-first на code-first.

Реализованы модели, контроллеры, формы для системы.

Также реализована логика отправки письма и логирование, отображение разного списка статусов интервью.
Также реализован логика создания связанных данных при приеме сотрудника на работу, отправка письма и логирование.


До коммита `91ff9da63e6039df643330e6b7e09e28ee92016d` или в ветке `badcode` реализовано как это делается "обычно, 
неопытным программистом".

В итоге получилось:
- огромные модели;
- сложные правила валидации на все случаи жизни;
- сложные контроллеры;
- не тестируемый код.

___


```txt
создание   \             / отправить письмо "вы приняты"
обновление ---- save() --- отправить письмо "вы повышены"
изменение  /             \ отправить письмо "вы в отпуске"
```

В ветке `badcode` проекта использованы только CRUD.

Мы пытаемся уместить в парадигму CRUD бизнес задачи.
```txt
Сотрудники
    - Создать
    - Редактировать
    - Удалить
    
Собеседования
    - Создать
    - Редактировать
    - Удалить
```

___
### Как это изменить?
Нужно продумать с точки зрения бизнеса.
```txt
- Пригласить на собеседование
- Пройти собеседование
- Отклонить собеседование
- Принять сотрудника
- Назначить сотрудника
- Отправить в отпуск
- Назначить премию
- Уволить
```

Если рассмотреть интервью как объект, то можно для него сделать методы:
```txt
1 -   join()   - 1
2 -   edit()   - 2
3 -   move()   - 3
4 -   pass()   - 4
5 -   reject() - 5
```
___

#### Пригласить на собеседование
Вынести в отдельный метод `пригласить на собеседование`. Так как для приглашения человека на
собеседование могут потребоваться не все поля, то сделать отдельную модель для валидации.
```php
$interview = Interview::join($date, $lastName, $firstName, $email);

 class InterviewJoinForm extends Model
 {
     public $date;
     public $lastName;
     public $firstName;
     public $email;

     public function rules() {
         return [
             [['date', 'lastName', 'firstName', 'email'], 'required']
         ];
     }
 }
```

Почему статический метод? Потому что может быть несколько вариантов создания.

Реализация представлена в ветке `refactoring/v1`
___
#### Пройти собеседование
```php
$employee = Employee::create(...);
$interview->passBy($employee);
```


___
#### Отклонить собеседование
```php
$interview->reject($reason);

 class InterviewRejectForm extends Model
 {
     public $reason;

     public function rules() {
         return [
             ['reason' , 'required']
         ];
     }
 }
```

Реализация логики отклонения собеседования в ветке `refactoring/v2`

___
#### Принять сотрудника
```php
$employee = Employee::create(...);
```
___
#### Назначить сотрудника
```php
$assignment = Assignment::assign($emplyee, $position, $date);
```


























